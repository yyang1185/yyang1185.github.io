---
title: 测试实例总结 No.02
date: 2018-02-12 14:46:13
categories: 测试实例
---
#### 问题1: 定位兄弟节点
发现了一个不错的测试工程师的[博客][1]。其中的[一篇][2]博客，对 Selenium 中利用各节点之间相对位置关系来定位的方法进行了非常详细的说明。
在最近的测试工作中利用了博客里说明的定位 sibling 节点的内容，web page 的 html 片段如下：
~~~~{html}
<tr ng-repeat="wlan in wlans" class="ng-scope">
        <td>
            <label class="form-control-static">
                    <a href="#/network/Service_1" class="ng-binding">Service_1</a>
            </label>
        </td>

        <td>
            <md-checkbox name="3152077c-f0a6-11e7-a978-000c29440798chk[]" class="form-control no-shadow ng-pristine ng-untouched ng-valid md-default-theme" id="Radio1" aria-label="Radio1" ng-model="radioPorts[wlan.id].R1" role="checkbox" tabindex="0" aria-checked="false" aria-invalid="false"><div class="md-container" md-ink-ripple="" md-ink-ripple-checkbox=""><div class="md-icon"></div></div><div ng-transclude="" class="md-label"></div></md-checkbox>
        </td>
        <td>
            <md-checkbox name="3152077c-f0a6-11e7-a978-000c29440798chk[]" class="form-control no-shadow ng-pristine ng-untouched ng-valid md-default-theme" id="Radio2" aria-label="Radio2" ng-model="radioPorts[wlan.id].R2" role="checkbox" tabindex="0" aria-checked="false" aria-invalid="false"><div class="md-container" md-ink-ripple="" md-ink-ripple-checkbox=""><div class="md-icon"></div></div><div ng-transclude="" class="md-label"></div></md-checkbox>
        </td>
        <td>
            <md-checkbox name="3152077c-f0a6-11e7-a978-000c29440798chk[]" class="form-control no-shadow ng-pristine ng-untouched ng-valid md-default-theme" id="Port1" aria-label="Port1" ng-model="radioPorts[wlan.id].P1" role="checkbox" tabindex="0" aria-checked="false" aria-invalid="false"><div class="md-container" md-ink-ripple="" md-ink-ripple-checkbox=""><div class="md-icon"></div></div><div ng-transclude="" class="md-label"></div></md-checkbox>
        </td>
        <td>
            <md-checkbox name="3152077c-f0a6-11e7-a978-000c29440798chk[]" class="form-control no-shadow ng-pristine ng-untouched ng-valid md-default-theme" id="Port2" aria-label="Port2" ng-model="radioPorts[wlan.id].P2" role="checkbox" tabindex="0" aria-checked="false" aria-invalid="false"><div class="md-container" md-ink-ripple="" md-ink-ripple-checkbox=""><div class="md-icon"></div></div><div ng-transclude="" class="md-label"></div></md-checkbox>
        </td>
        <td>
            <md-checkbox name="3152077c-f0a6-11e7-a978-000c29440798chk[]" class="form-control no-shadow ng-pristine ng-untouched ng-valid md-default-theme" id="Port3" aria-label="Port3" ng-model="radioPorts[wlan.id].P3" role="checkbox" tabindex="0" aria-checked="false" aria-invalid="false"><div class="md-container" md-ink-ripple="" md-ink-ripple-checkbox=""><div class="md-icon"></div></div><div ng-transclude="" class="md-label"></div></md-checkbox>
        </td>
</tr>
~~~~

可见，`<tr>` 中只有第一段 `<td>` 的 `<label>` 段在页面中具备唯一性，可以用作定位元素。对于其他 `<td>` 元素则可以在 xpath 中使用第一段 `<td>` 加 `following-sibling::` 的方法定位。测试用例中对应代码片段如下：
~~~~{python}
for radio_port in str(arg_dict["radio_ports"]).split(","):
    self.builder.add_left_click_command(ui_cmd_obj, "//label[@class='form-control-static']/a[.='"
                                        + str(arg_dict["network_name"]) + "']/../../following-sibling::td/md-checkbox[@id='" + str(radio_port).replace(' ', '') + "']")                    
~~~~
这段代码首先会定位第一段 `<td>` 中的 text。并在这个位置上向上回溯两次 (`/../..`) 返回到text的二级父节点 `<td>` 。紧接着使用 `following-sibling:: + @id=` 的方式定位想要选取的 checkbox。实践有效。

#### 问题2: 点击打开扩展菜单自动关闭
在测试网页上有一个 Navigation left panel。其中一些标签包含扩展菜单，在单击后展开。Selenium 脚本中，用默认的单击方法单击标签后，展开的菜单会自动关闭，导致脚本无法继续选取展开菜单项。使用 Google Developer 工具 Debug 后， 发现点击标签后会触发一个 getRippleElement(css) 动态特效。怀疑是在运行脚本时，Selenium 脚本与浏览器的响应之间并不能达到完全同步，会产生一些延时。这就会导致动态特效的触发出现了延迟。从而使延迟触发的特效关闭了已经展开的扩展菜单。
解决方法是使用 Selemiun 的 JavaScriptExecutor 来执行单击操作。这样网页中的动态特效将不会被触发。
Selenium 代码片段如下：
~~~{python}
driver.execute_script("arguments[0].click();", web_object)
~~~
实测有效。

[1]: https://huilansame.github.io/
[2]: https://huilansame.github.io/huilansame.github.io/archivers/father-brother-locate
